# Урок 06. "Управление пакетами. Дистрибьюция софта."
## Домашнее задание
Размещаем свой RPM в своем репозитории
Часто в задачи администратора входит не только установка пакетов, но и сборка и поддержка собственного репозитория. Этим и займемся в ДЗ.
-  создать свой RPM (можно взять свое приложение, либо собрать к примеру апач с определенными опциями)
- создать свой репо и разместить там свой RPM
реализовать это все либо в вагранте, либо развернуть у себя через nginx и дать ссылку на репо

* реализовать дополнительно пакет через docker

Критерии оценки:
- 5 - есть репо и рпм
- +1 - сделан еще и докер образ

## Результат
Результатом выполнения домашнего задания будут два решения с одним и тем же результатом (сборка rpm пакета markdown редактора [Typora](https://typora.io/) и публикация его в репозитарий).

###  Vagrant
В данном решении использован механизм ansible provisioning. Хосту назначаются две роли: otus_build и otus_repo.

В роли otus_build выполняется:
- Сборка src пакета из spec файла
- Сборка rpm пакета из src пакета при помощи утилиты `mock`

В роли otus_repo выполняется:
- Установка и конфигурация сервиса nginx
- Создание директории с репозиторием
- Размещение собранного пакета в этом репозитарии
- Создание индекса репозитария (`createrepo`)

Запуск стенда
```bash
# cd vagrant
# vagrant up
```

Доступ к репозитарию
```bash
# curl http://127.1:8080/repos/
```

### Docker

В данном решении использован метод multi-stage сборки (требуется версия Docker 17.05 и выше). В отличии от решения с Vagrant сборка пакета осуществляется через `yum-builddep` и `rpmbuild -bb` (проблема `mock` "namespace unshare" решение которой требует больше времени и выходит за рамки домашнего задания). 

> Данное решение не является правильным примером для продакшена, т.к. задачей было показать аналогичность достижения поставленной цели разными инструментами.

Сборка образа
```bash
# cd docker
# docker build -t otus-lesson06 .
```

Запуск контейнера
```bash
# docker run -d -p 8080:8080 --name otus-repo otus-lesson06
```

Доступ к репозитарию
```bash
# curl http://127.1:8080/repos/
```